<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>5Pointers ì„œë¸Œë„ë©”ì¸ ëŒ€ì‹œë³´ë“œ</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; 
            background: #f8fafc; 
            padding: 20px;
        }
        .container { max-width: 1200px; margin: 0 auto; }
        .header { 
            background: white; 
            padding: 30px; 
            border-radius: 12px; 
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            text-align: center;
        }
        .status { 
            background: #e8f5e8; 
            color: #2d5e2d; 
            padding: 15px 20px; 
            border-radius: 8px; 
            margin: 20px 0;
            border-left: 4px solid #4ade80;
        }
        .grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); 
            gap: 20px; 
        }
        .card { 
            background: white; 
            padding: 25px; 
            border-radius: 12px; 
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .card h3 { 
            color: #1e293b; 
            margin-bottom: 15px; 
            font-size: 18px;
        }
        .site-list { 
            list-style: none; 
            max-height: 400px; 
            overflow-y: auto;
        }
        .site-item { 
            padding: 12px; 
            margin-bottom: 8px; 
            background: #f8fafc; 
            border-radius: 8px; 
            border: 1px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .site-name { 
            font-weight: 500; 
            color: #1e40af; 
            text-decoration: none;
        }
        .site-name:hover { 
            text-decoration: underline; 
        }
        .test-btn { 
            background: #3b82f6; 
            color: white; 
            padding: 6px 12px; 
            border: none; 
            border-radius: 6px; 
            cursor: pointer; 
            font-size: 12px;
        }
        .test-btn:hover { 
            background: #2563eb; 
        }
        .instruction { 
            background: #fef3c7; 
            color: #92400e; 
            padding: 15px; 
            border-radius: 8px; 
            margin: 15px 0;
            border-left: 4px solid #f59e0b;
        }
        .hosts-content { 
            background: #f1f5f9; 
            padding: 15px; 
            border-radius: 8px; 
            font-family: 'Courier New', monospace; 
            font-size: 12px; 
            max-height: 300px; 
            overflow-y: auto;
            border: 1px solid #cbd5e1;
        }
        .loading { 
            text-align: center; 
            color: #64748b; 
            padding: 20px; 
        }
        .error { 
            background: #fee2e2; 
            color: #dc2626; 
            padding: 15px; 
            border-radius: 8px; 
            margin: 15px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸŒ 5Pointers ì„œë¸Œë„ë©”ì¸ ëŒ€ì‹œë³´ë“œ</h1>
            <div class="status" id="status">
                âœ… ì„œë¸Œë„ë©”ì¸ ì„œë²„ê°€ ì‹¤í–‰ ì¤‘ì…ë‹ˆë‹¤ (í¬íŠ¸ 3001)
            </div>
        </div>

        <div class="grid">
            <div class="card">
                <h3>ğŸ“‹ ë°°í¬ëœ ì„œë¸Œë„ë©”ì¸ ëª©ë¡</h3>
                <div id="sites-loading" class="loading">ë¡œë”© ì¤‘...</div>
                <ul id="sites-list" class="site-list" style="display: none;"></ul>
            </div>

            <div class="card">
                <h3>ğŸ”§ ë¸Œë¼ìš°ì € ì ‘ê·¼ ì„¤ì •</h3>
                <div class="instruction">
                    <strong>ë°©ë²• 1: /etc/hosts íŒŒì¼ ìˆ˜ì • (ê¶Œì¥)</strong><br>
                    ì•„ë˜ ë‚´ìš©ì„ ë³µì‚¬í•´ì„œ /etc/hosts íŒŒì¼ì— ì¶”ê°€í•˜ì„¸ìš”.
                </div>
                <div id="hosts-entries" class="hosts-content">ë¡œë”© ì¤‘...</div>
                
                <div style="margin-top: 15px;">
                    <button onclick="copyHostsEntries()" class="test-btn">ğŸ“‹ ë³µì‚¬í•˜ê¸°</button>
                    <button onclick="refreshData()" class="test-btn">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
                </div>
            </div>

            <div class="card">
                <h3>ğŸ§ª í…ŒìŠ¤íŠ¸ ë„êµ¬</h3>
                <p>ì•„ë˜ ë°©ë²•ë“¤ë¡œ ì„œë¸Œë„ë©”ì¸ì´ ì‘ë™í•˜ëŠ”ì§€ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:</p>
                <div style="margin-top: 15px;">
                    <div style="margin-bottom: 10px;">
                        <strong>curl í…ŒìŠ¤íŠ¸:</strong><br>
                        <code style="background: #f1f5f9; padding: 5px; border-radius: 4px; display: block; margin-top: 5px;">
                            curl -H "Host: testsite.localhost:3001" http://localhost:3001
                        </code>
                    </div>
                    <div style="margin-bottom: 10px;">
                        <strong>ì„œë¸Œë„ë©”ì¸ ì„œë²„ ìƒíƒœ:</strong><br>
                        <a href="http://localhost:3001" target="_blank" class="site-name">localhost:3001 ì—´ê¸°</a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let subdomains = [];

        async function fetchSubdomains() {
            try {
                // ì‹¤ì œë¡œëŠ” APIì—ì„œ ê°€ì ¸ì™€ì•¼ í•˜ì§€ë§Œ, ì—¬ê¸°ì„œëŠ” ê³ ì • ëª©ë¡ ì‚¬ìš©
                // ì‹¤ì œ êµ¬í˜„ì‹œì—ëŠ” ë°±ì—”ë“œ APIë¥¼ í˜¸ì¶œ
                const response = await fetch('/api/subdomains'); // ì´ê±´ ì‹¤ì œë¡œëŠ” ì‘ë™í•˜ì§€ ì•ŠìŒ
                return await response.json();
            } catch (error) {
                // ê³ ì • ì„œë¸Œë„ë©”ì¸ ëª©ë¡ (í…ŒìŠ¤íŠ¸ìš©)
                return [
                    { subdomain: 'testsite', title: 'Test Site', updated_at: new Date() },
                    { subdomain: 'testpage2', title: 'Test Page 2', updated_at: new Date() },
                    { subdomain: '23qwe', title: 'Elegant Wedding Invitation', updated_at: new Date() },
                    { subdomain: '31as', title: 'Untitled', updated_at: new Date() }
                ];
            }
        }

        function renderSites(sites) {
            const sitesList = document.getElementById('sites-list');
            const loading = document.getElementById('sites-loading');
            
            loading.style.display = 'none';
            sitesList.style.display = 'block';
            
            sitesList.innerHTML = sites.map(site => `
                <li class="site-item">
                    <div>
                        <div class="site-name">${site.subdomain}</div>
                        <small style="color: #64748b;">${site.title}</small>
                    </div>
                    <button class="test-btn" onclick="testSite('${site.subdomain}')">í…ŒìŠ¤íŠ¸</button>
                </li>
            `).join('');

            // hosts íŒŒì¼ ì—”íŠ¸ë¦¬ ìƒì„±
            const hostsEntries = sites.map(site => 
                `127.0.0.1   ${site.subdomain}.localhost`
            ).join('\n');
            
            document.getElementById('hosts-entries').textContent = 
                '# 5Pointers Subdomains\n' + hostsEntries;
        }

        function testSite(subdomain) {
            // Host í—¤ë”ë¥¼ ì‚¬ìš©í•œ í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•´ ìƒˆ ì°½ ì—´ê¸°
            const testUrl = `http://localhost:3001`;
            const newWindow = window.open('about:blank', '_blank');
            
            // ì‚¬ìš©ìì—ê²Œ ì•ˆë‚´
            newWindow.document.write(`
                <html>
                <head><title>ì„œë¸Œë„ë©”ì¸ í…ŒìŠ¤íŠ¸: ${subdomain}</title></head>
                <body style="font-family: sans-serif; padding: 20px;">
                    <h2>ì„œë¸Œë„ë©”ì¸ í…ŒìŠ¤íŠ¸: ${subdomain}</h2>
                    <p><strong>ë°©ë²• 1:</strong> /etc/hosts íŒŒì¼ì— ë‹¤ìŒì„ ì¶”ê°€í•œ í›„ ë¸Œë¼ìš°ì €ì—ì„œ ì ‘ê·¼:</p>
                    <code style="background: #f0f0f0; padding: 10px; display: block;">127.0.0.1   ${subdomain}.localhost</code>
                    <p>ê·¸ ë‹¤ìŒ <a href="http://${subdomain}.localhost:3001" target="_blank">http://${subdomain}.localhost:3001</a>ë¡œ ì ‘ê·¼</p>
                    
                    <p><strong>ë°©ë²• 2:</strong> curl ëª…ë ¹ì–´ë¡œ í…ŒìŠ¤íŠ¸:</p>
                    <code style="background: #f0f0f0; padding: 10px; display: block;">curl -H "Host: ${subdomain}.localhost:3001" http://localhost:3001</code>
                    
                    <p><strong>ë°©ë²• 3:</strong> ê°œë°œì ë„êµ¬ì—ì„œ Network íƒ­ì„ ì—´ê³  localhost:3001 ìš”ì²­ì˜ í—¤ë”ì— ë‹¤ìŒì„ ì¶”ê°€:</p>
                    <code style="background: #f0f0f0; padding: 10px; display: block;">Host: ${subdomain}.localhost:3001</code>
                </body>
                </html>
            `);
        }

        function copyHostsEntries() {
            const hostsContent = document.getElementById('hosts-entries').textContent;
            navigator.clipboard.writeText(hostsContent).then(() => {
                alert('ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤! /etc/hosts íŒŒì¼ì— ë¶™ì—¬ë„£ê¸° í•˜ì„¸ìš”.');
            }).catch(() => {
                alert('ë³µì‚¬ ì‹¤íŒ¨. ë‚´ìš©ì„ ìˆ˜ë™ìœ¼ë¡œ ì„ íƒí•´ì„œ ë³µì‚¬í•˜ì„¸ìš”.');
            });
        }

        async function refreshData() {
            document.getElementById('sites-loading').style.display = 'block';
            document.getElementById('sites-list').style.display = 'none';
            
            const sites = await fetchSubdomains();
            renderSites(sites);
        }

        // í˜ì´ì§€ ë¡œë“œì‹œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
        window.addEventListener('load', refreshData);
    </script>
</body>
</html>